<!doctype html>
<html lang="es-AR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GB Production Board</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="shell">
    <aside class="sidebar">
      <div class="brand">
        <input id="projectTitle" class="titleInput" placeholder="Proyecto" />
        <div class="sub">
          Guardado: <span id="savedAtText">—</span>
        </div>
      </div>

      <nav class="nav">
        <button class="navBtn" data-view="breakdown">Breakdown</button>
        <button class="navBtn" data-view="shooting">Plan de Rodaje</button>
        <button class="navBtn" data-view="schedule">Cronograma</button>
        <button class="navBtn" data-view="elements">Elementos</button>
        <button class="navBtn" data-view="crew">Equipo técnico</button>
        <button class="navBtn" data-view="reports">Reportes</button>
        <button class="navBtn" data-view="callsheet">Call Sheets</button>
      </nav>

      <div class="navBottom">
        <div class="pillRow">
          <span class="pill" id="syncPill">Local</span>
          <span class="pill muted" id="statusText">—</span>
        </div>
        <button class="navBtn bottom" data-view="settings">Sync / Ajustes</button>
      </div>
    </aside>

    <main class="main">
      <div id="toast" class="toast" style="display:none;"></div>
      <div id="hoverTip" class="hoverTip" style="display:none;"></div>

      <!-- ================= BREAKDOWN ================= -->
      <section id="view-breakdown" class="view">
        <!-- PRIMERO: Escenas + Editor -->
        <div class="grid2">
          <div class="card" id="sceneListCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Escenas</h2>
              <div class="row gap">
                <button id="btnAddScene" class="btn">+ Escena</button>
                <button id="btnDuplicateScene" class="btn">Duplicar</button>
                <button id="btnDeleteScene" class="btn danger">Borrar</button>
              </div>
            </div>

            <div class="cardContent">
              <div class="row gap">
                <input id="sceneSearch" class="input grow" placeholder="Buscar escena…" />
                <select id="sceneFilterTOD" class="input compact">
                  <option value="">TOD</option>
                  <option value="Día">Día</option>
                  <option value="Noche">Noche</option>
                  <option value="Amanecer">Amanecer</option>
                  <option value="Atardecer">Atardecer</option>
                </select>
              </div>

              <div class="tableWrap">
                <table id="sceneTable" class="table">
                  <thead>
                    <tr>
                      <th style="width:72px;">#</th>
                      <th>Slugline</th>
                      <th>Locación</th>
                      <th style="width:120px;">TOD</th>
                      <th style="width:80px;">Pág</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card" id="sceneEditorCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Editor</h2>
              <div id="selectedSceneHint" class="muted small">Seleccioná una escena</div>
            </div>

            <div class="cardContent">
              <div class="gridEditor">
                <div class="field">
                  <label>Nro</label>
                  <input id="scene_number" class="input" />
                </div>
                <div class="field">
                  <label>Slugline</label>
                  <input id="scene_slugline" class="input" />
                </div>
                <div class="field">
                  <label>Locación</label>
                  <input id="scene_location" class="input" />
                </div>
                <div class="field">
                  <label>Momento del día</label>
                  <input id="scene_timeOfDay" class="input" placeholder="Día / Noche" />
                </div>
                <div class="field">
                  <label>Páginas</label>
                  <input id="scene_pages" class="input" type="number" min="0" step="0.25" />
                </div>
              </div>

              <div class="field">
                <label>Resumen</label>
                <textarea id="scene_summary" class="textarea smallArea"></textarea>
              </div>
              <div class="field">
                <label>Notas</label>
                <textarea id="scene_notes" class="textarea smallArea"></textarea>
              </div>

              <div class="row gap alignEnd">
                <div class="field">
                  <label>Categoría</label>
                  <select id="elCategory" class="input"></select>
                </div>
                <div class="field grow">
                  <label>Elemento</label>
                  <input id="elItem" class="input" list="elSuggestDatalist" placeholder="Ej: Pistola, Sombrero…" />
                  <datalist id="elSuggestDatalist"></datalist>
                </div>
                <button id="btnAddSceneElement" class="btn primary">Agregar</button>
              </div>

              <div class="spacer"></div>
              <div id="sceneElementsGrid"></div>
              <div class="spacer"></div>
              <div class="row gap alignEnd">
                <div class="colTitle" style="margin:0;">Planos</div>
                <button id="btnAddShot" class="btn">+ Plano</button>
              </div>
              <div class="tableWrap shotsWrap">
                <table id="shotsTable" class="table">
                  <thead>
                    <tr>
                      <th style="width:56px;">#</th>
                      <th style="width:180px;">Tipo</th>
                      <th>Descripción</th>
                      <th style="width:72px;"></th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

            </div>
          </div>
        </div>

        <!-- ABAJO: importación (secundaria) + colapsable -->
        
          <div class="grid2">
            <div class="card collapsible collapsed span2" data-collapse-key="bd_script">
              <div class="cardHeader">
                <div class="cardTitle">GUION EN EL BREAKDOWN <span class="keepcase">(versión y planos)</span></div>
                <div class="collapseToggle" title="Expandir/Colapsar">▸</div>
              </div>
              <div class="cardContent">
                <div class="row gap">
                  <select id="scriptVerSelect" class="input" style="max-width:240px"></select>
                  <button class="btn" id="btnNewScriptVersion">Nueva versión</button>
                  <span class="pill" id="scriptVerMeta">—</span>
                </div>

                <div class="scriptWrap" id="scriptVersionUI" style="display:none">
                  <div class="scriptLeft">
                    <div class="muted small">Escenas de la versión (doble click = editar en el proyecto)</div>
                    <div class="scriptList" id="scriptSceneList"></div>
                    <div class="row gap">
                      <button class="btn" id="btnScriptInsertAfter">+ Escena (6A)</button>
                      <button class="btn" id="btnScriptApply">Incorporar cambios al proyecto</button>
                    </div>
                  </div>

                  <div class="scriptRight">
                    <div class="muted small">Editor de escena (versión)</div>
                    <div class="row gap">
                      <div class="grow">
                        <label class="small">Slugline</label>
                        <input class="input" id="scriptSceneSlugline" placeholder="INT. CASA - DÍA" />
                      </div>
                      <div style="max-width:120px">
                        <label class="small">Nº</label>
                        <input class="input" id="scriptSceneNumber" placeholder="6A" />
                      </div>
                    </div>
                    <div class="row gap">
                      <div class="grow">
                        <label class="small">Lugar</label>
                        <input class="input" id="scriptSceneLocation" placeholder="LIVING" />
                      </div>
                      <div style="max-width:140px">
                        <label class="small">Momento</label>
                        <select class="input" id="scriptSceneTOD">
                          <option>Día</option><option>Noche</option><option>Atardecer</option><option>Amanecer</option>
                        </select>
                      </div>
                    </div>
                    <label class="small">Texto</label>
                    <textarea class="input" id="scriptSceneBody" rows="6" placeholder="Pegá acá el texto de la escena…"></textarea>

                    <div class="row gap" style="justify-content:flex-end">
                      <button class="btn" id="btnScriptSaveScene">Guardar cambios</button>
                    </div>

                    <div class="divider"></div>
                    <div class="muted small">Lectura cómoda</div>
                    <div class="scriptRead" id="scriptReadView"></div>
                  </div>
                </div>

                <div class="divider"></div>
                <div class="muted small">Cómo usarlo</div>
                <ol class="small">
                  <li>Creá una versión nueva, pegá el guion (o editá las escenas acá).</li>
                  <li>Insertá escenas intermedias: 6 → 6A → 6B…</li>
                  <li>Cuando esté OK, incorporá al proyecto (se sincroniza).</li>
                </ol>
                <div class="muted small">Tip: en el guion, el buscador de escenas funciona si el slugline arranca con INT./EXT.</div>
              </div>
            </div>
          </div>

      </section>

      <!-- ================= PLAN DE RODAJE ================= -->
      <section id="view-shooting" class="view hidden">
        <div id="shootingLayout" class="shootingLayout">
          <!-- Banco -->
          <div id="bankCol" class="col">
            <div class="card bankCard">
              <div class="cardHeader bankHeader" id="sceneBankHeader">
                <h2 class="cardTitle">Banco de Escenas</h2>
                <button id="btnToggleBank" class="btn icon" title="Colapsar/expandir">⟨</button>
              </div>

              <div class="cardContent" id="sceneBankBody">
                <div class="row gap">
                  <input id="bankSearch" class="input grow" placeholder="Buscar…" />
                  <select id="bankFilter" class="input compact">
                    <option value="all">Todas</option>
                    <option value="unassigned">No asignadas</option>
                  </select>
                </div>
                <div id="sceneBankList" class="bankList"></div>
              </div>
            </div>

            <!-- Dock visible cuando está colapsado -->
            <div id="bankDock" class="bankDock hidden">
              <button id="btnToggleBankDock" class="btn icon" title="Expandir">⟩</button>
            </div>
          </div>

          <!-- Tablero + Detalle -->
          <div class="col">
            <div class="card" id="daysBoardCard">
              <div class="cardHeader">
                <h2 class="cardTitle">Tablero de Días</h2>
                <div class="row gap">
                  <button id="btnAddShootDay" class="btn">+ Día</button>
                  <button id="btnDeleteShootDay" class="btn danger">Borrar Día</button>
                </div>
              </div>
              <div class="cardContent">
                <div id="daysBoardWrap" class="daysBoardWrap">
                  <div id="daysBoard" class="daysBoard"></div>
                </div>
              </div>
            </div>

            <div class="card" id="dayDetailCard">
              <div class="cardHeader">
                <h2 class="cardTitle">Detalle del Día</h2>
                <button id="btnOpenCallSheet" class="btn">Ver Call Sheet</button>
              </div>

              <div class="cardContent">
                <div class="dayDetail3col">
                  <!-- Col 1 -->
                  <div class="col">
                    <div class="field">
                      <label>Fecha</label>
                      <input id="day_date" class="input" type="date" />
                    </div>

                    <div class="field">
                      <label>Call Time</label>
                      <div class="row gap">
                        <button id="day_call_minus" class="btn icon" title="-15">−</button>
                        <input id="day_call" class="input grow" placeholder="08:00" />
                        <button id="day_call_plus" class="btn icon" title="+15">+</button>
                      </div>
                    </div>

                    <div class="field">
                      <label>Locación</label>
                      <input id="day_location" class="input" />
                    </div>

                    <div class="field">
                      <label>Nombre</label>
                      <input id="day_label" class="input" />
                    </div>

                    <div class="field">
                      <label>Notas</label>
                      <textarea id="day_notes" class="textarea smallArea"></textarea>
                    </div>
                  </div>

                  <!-- Col 2 -->
                  <div class="col">
                    <div class="colTitle">Necesidades por Área</div>
                    <div id="dayNeeds"></div>
                  </div>

                  <!-- Col 3 -->
                  <div class="col">
                    <div class="colTitle">Cast citado (auto)</div>
                    <div id="dayCast"></div>

                    <div class="spacer"></div>
                    <div class="colTitle">Equipo técnico (clic para seleccionar)</div>
                    <div id="dayCrewPicker"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- ================= CRONOGRAMA ================= -->
      <section id="view-schedule" class="view hidden">
        <div class="card" id="scheduleCard">
          <div class="cardHeader">
            <h2 class="cardTitle">Cronograma</h2>
            <div class="row gap">
              <label class="row gap small muted">Zoom
                <select id="schedZoom" class="input compact">
                  <option value="60">Bajo</option>
                  <option value="90" selected>Medio</option>
                  <option value="120">Grande</option>
                  <option value="160">Gigante</option>
                </select>
              </label>
              <label class="row gap small muted">Snap
                <select id="schedSnap" class="input compact">
                  <option value="5">5 min</option>
                  <option value="10">10 min</option>
                  <option value="15" selected>15 min</option>
                  <option value="30">30 min</option>
                </select>
              </label>
            </div>
          </div>
          <div class="cardContent scheduleContent">
            <!-- Scroll horizontal superior (siempre accesible) -->
            <div id="schedScrollTop" class="schedScrollTop">
              <div id="schedScrollTopInner" class="schedScrollTopInner"></div>
            </div>

            <div id="schedWrap" class="schedWrap">
              <div id="schedBoard" class="schedBoard"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= ELEMENTOS ================= -->
      <section id="view-elements" class="view hidden">
        <div class="grid2">
          <div class="card">
            <div class="cardHeader">
              <h2 class="cardTitle">Explorar elementos</h2>
            </div>
            <div class="cardContent">
              <div class="row gap">
                <select id="elxCategory" class="input compact"></select>
                <select id="elxDay" class="input compact"></select>
                <input id="elxSearch" class="input grow" placeholder="Buscar elemento…" />
              </div>
              <div class="spacer"></div>
              <div id="elxList"></div>
            </div>
          </div>
          <div class="card">
            <div class="cardHeader">
              <h2 class="cardTitle">Detalle</h2>
            </div>
            <div class="cardContent">
              <div id="elxDetail"></div>
            </div>
        </div>
      </section>

      <!-- ================= CREW ================= -->
      <section id="view-crew" class="view hidden">
        <div class="card" id="crewCard">
          <div class="cardHeader">
            <h2 class="cardTitle">Equipo técnico <span class="keepcase">(incluye Cast como área)</span></h2>
            <div class="row gap">
              <input id="crewSearch" class="input grow" placeholder="Buscar por área / rol / nombre…" />
              <button id="btnAddCrew" class="btn">+ Integrante</button>
            </div>
          </div>
          <div class="cardContent">
            <div class="tableWrap">
              <table id="crewTable" class="table">
                <thead>
                  <tr>
                    <th style="width:190px;">Área</th>
                    <th style="width:200px;">Rol</th>
                    <th>Nombre</th>
                    <th style="width:140px;">Tel</th>
                    <th style="width:220px;">Email</th>
                    <th>Notas</th>
                    <th style="width:110px;"></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
        </div>
      </section>

      <!-- ================= REPORTES ================= -->
      <section id="view-reports" class="view hidden">
        <div class="card">
          <div class="cardHeader">
            <h2 class="cardTitle">Reportes por día</h2>
            <button id="btnRefreshReports" class="btn">Actualizar</button>
          </div>
          <div class="cardContent">
            <div id="reportsBoard" class="reportsBoard"></div>
          </div>
        </div>
      </section>

      <!-- ================= CALL SHEETS ================= -->
      <section id="view-callsheet" class="view hidden">
        <div class="grid2">
          <div class="card noPrint" id="callCalCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Calendario</h2>
              <div class="row gap">
                <button id="calPrev" class="btn icon" title="Mes anterior">‹</button>
                <div id="calTitle" class="muted"></div>
                <button id="calNext" class="btn icon" title="Mes siguiente">›</button>
              </div>
            </div>
            <div class="cardContent">
              <div class="calGrid" id="calGrid"></div>
            </div>
          </div>

          <div class="card" id="callDetailCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Call Sheet</h2>
              <button id="btnPrintCallSheet" class="btn primary">Imprimir</button>
            </div>
            <div class="cardContent">
              <div id="callSheetDetail"></div>
            </div>
        </div>
      </section>

      <!-- ================= SETTINGS ================= -->
      <section id="view-settings" class="view hidden">
        <div class="grid2">
          <div class="card">
            <div class="cardHeader">
              <h2 class="cardTitle">JSONBin</h2>
            </div>
            <div class="cardContent">
              <div class="field">
                <label>Bin ID</label>
                <input id="cfg_binId" class="input" readonly />
              </div>
              <div class="field">
                <label>Access Key</label>
                <input id="cfg_accessKey" class="input" readonly />
              </div>
              <div class="field">
                <label>Autosync</label>
                <select id="cfg_autosync" class="input" disabled>
                  <option value="on">On</option>
                </select>
              </div>
              <div class="row gap">
                <button id="btnSaveCfg" class="btn">Guardar</button>
                <button id="btnTestCfg" class="btn">Probar conexión</button>
                <button id="btnPullRemote" class="btn">Traer remoto</button>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="js/utils.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
