<!doctype html>
<html lang="es-AR" data-build="20251229-05"><head>
  <meta charset="utf-8"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
  <meta content="width=device-width,initial-scale=1,viewport-fit=cover" name="viewport"/>
  <title>GB Production Board</title>
  <link href="css/styles.css?v=20251229-05" rel="stylesheet"/>
</head>
<body>
  <div class="shell">
    <aside class="sidebar">
      <div class="brand">
        <div class="brandTop">
          <div class="projPill" id="projPill" title="Proyecto"></div>
          <button class="btn icon ghost small" id="btnNavCollapse" type="button" title="Colapsar/Expandir">‚ü®</button>
        </div>

        <input class="titleInput" id="projectTitle" placeholder="Proyecto"/>
        <select class="input projectSwitch" id="projectSwitch" title="Proyecto"></select>

        <!-- Permisos: por defecto modo lector (imprimir sigue disponible) -->
        <div class="authBar" id="authBar">
          <div class="authRow">
            <span class="authStatus" id="authStatus">üîí Lector</span>
            <span class="pill muted small" id="authHint">Solo lectura</span>
          </div>
          <div class="row gap">
            <button class="btn ghost small" id="btnUnlockEdit" type="button">Desbloquear</button>
            <button class="btn ghost small hidden" id="btnLockEdit" type="button">Bloquear</button>
            <button class="btn ghost small hidden" id="btnChangeEditPass" type="button" title="Cambiar contrase√±a">Clave</button>
          </div>
        </div>
      </div>

      <nav class="nav">
        <button class="navBtn" data-view="breakdown"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Breakdown</span></button>
        <button class="navBtn" data-view="shooting"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Call Diario</span></button>
        <button class="navBtn" data-view="dayplan"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Plan de Rodaje</span></button>
        <button class="navBtn" data-view="schedule"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Plan General</span></button>
        <button class="navBtn" data-view="shotlist"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Shotlist</span></button>
        <button class="navBtn" data-view="elements"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Elementos</span></button>
        <button class="navBtn" data-view="crew"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Equipo t√©cnico</span></button>
        <button class="navBtn" data-view="reports"><span class="navIco" aria-hidden="true"></span><span class="navLbl">Filtros</span></button>
        <button class="navBtn" data-view="callsheet"><span class="navIco" aria-hidden="true"></span><span class="navLbl">REPORTES</span></button>
      </nav>

      
    </aside>

    <main class="main">
      <div class="toast" id="toast" style="display:none;"></div>
      <div class="hoverTip" id="hoverTip" style="display:none;"></div>

      <!-- ================= BREAKDOWN ================= -->
      <section class="view" id="view-breakdown">
        <!-- PRIMERO: Escenas + Editor -->
        <div class="grid2">
          <div class="card" id="sceneListCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Escenas</h2>
              <div class="row gap">
                <button class="btn" id="btnAddScene">+ Escena</button>
                <button class="btn" id="btnDuplicateScene">Duplicar</button>
                <button class="btn danger" id="btnDeleteScene">Borrar</button>
              </div>
            </div>

            <div class="cardContent">
              <div class="row gap">
                <input class="input grow" id="sceneSearch" placeholder="Buscar escena‚Ä¶"/>
                <select class="input compact" id="sceneFilterTOD">
                  <option value="">TOD</option>
                  <option value="D√≠a">D√≠a</option>
                  <option value="Noche">Noche</option>
                  <option value="Amanecer">Amanecer</option>
                  <option value="Atardecer">Atardecer</option>
                </select>
              </div>

              <div class="tableWrap">
                <table class="table" id="sceneTable">
                  <thead>
                    <tr>
                      <th style="width:72px;">#</th>
                      <th>T√≠tulo</th>
                      <th style="width:70px;">I/E</th>
                      <th>Lugar</th>
                      <th style="width:120px;">Momento</th>
                      <th style="width:90px;">Largo</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card" id="sceneEditorCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Editor</h2>
              <div class="muted small" id="selectedSceneHint">Seleccion√° una escena</div>
            </div>

            <div class="cardContent">
              <div class="gridEditor">
                <div class="field">
                  <label>Nro</label>
                  <input class="input" id="scene_number"/>
                </div>
                <div class="field">
                  <label>Cap√≠tulo</label>
                  <input class="input" id="scene_chapter" type="number" min="1" step="1"/>
                </div>
                <div class="field">
                  <label>T√≠tulo</label>
                  <input class="input" id="scene_slugline"/>
                </div>
                <div class="field">
                  <label>Int / Ext</label>
                  <select class="input" id="scene_intExt">
                    <option value=""></option>
                    <option value="Int">Int</option>
                    <option value="Ext">Ext</option>
                  </select>
                </div>
                <div class="field">
                  <label>Lugar</label>
                  <input class="input" id="scene_location"/>
                </div>
                <div class="field">
                  <label>Momento del d√≠a</label>
                  <select class="input" id="scene_timeOfDay">
                    <option value=""></option>
                    <option value="D√≠a">D√≠a</option>
                    <option value="Noche">Noche</option>
                    <option value="Amanecer">Amanecer</option>
                    <option value="Atardecer">Atardecer</option>
                  </select>
                </div>
                <div class="field">
                  <label>Largo P√°ginas</label>
                  <input class="input" id="scene_pages" min="0" step="0.5" type="number"/>
                </div>
              </div>

              <div class="field">
                <label>Resumen</label>
                <textarea class="textarea smallArea" id="scene_summary"></textarea>
              </div>
              <div class="field">
                <label>Notas</label>
                <textarea class="textarea smallArea" id="scene_notes"></textarea>
              </div>

              <div class="row gap alignEnd">
                <div class="field">
                  <label>Categor√≠a</label>
                  <select class="input" id="elCategory"></select>
                </div>
                <div class="field grow">
                  <label>Elemento</label>
                  <input class="input" id="elItem" list="elSuggestDatalist" placeholder="Ej: Pistola, Sombrero‚Ä¶"/>
                  <datalist id="elSuggestDatalist"></datalist>
                </div>
                <button class="btn primary" id="btnAddSceneElement">Agregar</button>
              </div>

              <div class="spacer"></div>
              <div id="sceneElementsGrid"></div>
              <div class="spacer"></div>
              <div class="row gap alignEnd">
                <div class="colTitle" style="margin:0;">Planos</div>
                <button class="btn" id="btnAddShot">+ Plano</button>
              </div>
              <div class="tableWrap shotsWrap">
                <table class="table" id="shotsTable">
                  <thead>
                    <tr>
                      <th style="width:56px;">#</th>
                      <th style="width:180px;">Tipo</th>
                      <th>Descripci√≥n</th>
                      <th style="width:72px;"></th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

            </div>
          </div>
        </div>

        <!-- ABAJO: importaci√≥n (secundaria) + colapsable -->
        
          <div class="grid2">

            <div class="card span2" id="bdImportCard">
              <div class="cardHeader">
                <div class="cardTitle">Importar Breakdown <span class="keepcase">(Excel/CSV)</span></div>
                <div class="pill" id="bdImportStatus">‚Äî</div>
              </div>
              <div class="cardContent">
                <div class="row gap" style="flex-wrap:wrap;">
                  <button class="btn" id="btnBDTemplateWide" type="button">Descargar plantilla (por escena)</button>
                  <button class="btn ghost" id="btnBDTemplateLong" type="button">Plantilla (por √≠tem)</button>
                  <span class="muted small">Tip: en celdas pod√©s separar con coma, punto y coma o salto de l√≠nea.</span>
                </div>

                <div class="row gap alignEnd" style="flex-wrap:wrap; margin-top:10px;">
                  <div class="field grow" style="min-width:260px;">
                    <label>Archivo</label>
                    <input class="input" type="file" id="bdFileInput" accept=".xlsx,.xls,.csv" />
                  </div>

                  <div class="field" style="min-width:220px;">
                    <label>Modo</label>
                    <select class="input" id="bdImportMode">
                      <option value="merge">Sumar (no borra)</option>
                      <option value="replace" selected>Reemplazar (solo columnas presentes)</option>
                    </select>
                  </div>

                  <label class="row gap" style="align-items:center; margin:0;">
                    <input type="checkbox" id="bdImportCreateMissing" />
                    <span class="small">Crear escenas faltantes</span>
                  </label>

                  <button class="btn primary" id="btnBDImport" type="button">Importar</button>
                </div>

                <div class="muted small" style="margin-top:8px;">
                  Si una escena no existe: se ignora (o se crea si activ√°s la opci√≥n). Las categor√≠as soportadas: Cast, Props, Vestuario, Arte, Maquillaje, Sonido, SFX, VFX, Veh√≠culos, Animales, Extras.
                </div>
              </div>
            </div>

            <div class="card collapsible collapsed span2" data-collapse-key="bd_script">
              <div class="cardHeader">
                <div class="cardTitle">GUION EN EL BREAKDOWN <span class="keepcase">(versi√≥n y planos)</span></div>
                <div class="collapseToggle" title="Expandir/Colapsar">‚ñ∏</div>
              </div>
              <div class="cardContent">
                <div class="row gap">
                  <select class="input" id="scriptVerSelect" style="max-width:240px"></select>
                  <button class="btn" id="btnNewScriptVersion">Nueva versi√≥n</button>
                  <button class="btn ghost" id="btnToggleScriptImport">Pegar / Procesar</button>
                  <span class="pill" id="scriptVerMeta">‚Äî</span>
                </div>

                <div class="scriptWrap" id="scriptVersionUI" style="display:none">
                  <div class="scriptLeft">
                    <div class="muted small">Escenas de la versi√≥n (doble click = editar en el proyecto)</div>
                    <div class="scriptList" id="scriptSceneList"></div>
                    <div class="row gap">
                      <button class="btn" id="btnScriptInsertAfter">+ Escena (6A)</button>
                      <button class="btn" id="btnScriptApply">Incorporar cambios al proyecto</button>
                    </div>
                  </div>

                  <div class="scriptRight">
                    <div class="muted small">Editor de escena (versi√≥n)</div>
                    <div class="row gap">
                      <div class="grow">
                        <label class="small">T√≠tulo</label>
                        <input class="input" id="scriptSceneSlugline" placeholder="INT. CASA - D√çA"/>
                      </div>
                      <div style="max-width:120px">
                        <label class="small">N¬∫</label>
                        <input class="input" id="scriptSceneNumber" placeholder="6A"/>
                      </div>
                    </div>
                    <div class="row gap">
                      <div class="grow">
                        <label class="small">Lugar</label>
                        <input class="input" id="scriptSceneLocation" placeholder="LIVING"/>
                      </div>
                      <div style="max-width:140px">
                        <label class="small">Momento</label>
                        <select class="input" id="scriptSceneTOD">
                          <option>D√≠a</option><option>Noche</option><option>Atardecer</option><option>Amanecer</option>
                        </select>
                      </div>
                    </div>
                    <label class="small">Texto de escena</label>
                    <textarea class="input" id="scriptSceneBody" placeholder="Escrib√≠ o peg√° ac√° el texto de la escena‚Ä¶" rows="16"></textarea>

                    <div class="row gap" style="justify-content:flex-end">
                      <button class="btn" id="btnScriptSaveScene">Guardar cambios</button>
                    </div>

                    <div class="scriptImportPanel hidden" id="scriptImportPanel">
                      <div class="muted small">Peg√° el guion completo ac√° y lo proceso a escenas (reemplaza la versi√≥n actual).</div>
                      <textarea class="input" id="scriptImportText" placeholder="INT./EXT. por l√≠nea, como guion tradicional‚Ä¶" rows="8"></textarea>
                      <div class="row gap" style="align-items:flex-end">
                        <div class="grow">
                          <label class="small">Palabras clave (opcional)</label>
                          <input class="input" id="scriptKeywords" placeholder="Ej: lluvia, persecuci√≥n, dron‚Ä¶"/>
                        </div>
                        <button class="btn" id="btnParseScript">Procesar</button>
                        <button class="btn ghost" id="btnCancelScriptImport">Ocultar</button>
                      </div>
                    </div>

                  </div>
                </div>

                <div class="divider"></div>
                <div class="muted small">C√≥mo usarlo</div>
                <ol class="small">
                  <li>Cre√° una versi√≥n nueva, peg√° el guion (o edit√° las escenas ac√°).</li>
                  <li>Insert√° escenas intermedias: 6 ‚Üí 6A ‚Üí 6B‚Ä¶</li>
                  <li>Cuando est√© OK, incorpor√° al proyecto (se sincroniza).</li>
                </ol>
                <div class="muted small">Tip: en el guion, el buscador de escenas funciona si el slugline arranca con INT./EXT.</div>
              </div>
            </div>
          </div>

      </section>

            <!-- ================= CALL DIARIO ================= -->
      <section class="view hidden" id="view-shooting">
        <div class="shootingLayout noBank" id="shootingLayout">
          <div class="col">

            <div class="card" id="dayDetailCard">
              <div class="cardHeader">

                <div class="titleBlock">
                  <h2 class="cardTitle" id="dayDetailTitle">Detalle del D√≠a</h2>
                  <div class="dayHeaderMeta" id="dayDetailMeta"></div>
                </div>
                <div class="row gap">
                  <select class="input compact" id="shootDaySelect"></select>
                  <button class="btn" id="btnOpenCallSheet">Imprimir</button>
                </div>
              </div>

              <div class="cardContent">
                <div class="dayDetail3col">
  <!-- Col 1 -->
  <div class="col">
    <div class="colTitle">Escenas del d√≠a</div>
    <div id="dayScenesDetail"></div>
  </div>

  <!-- Col 2 -->
  <div class="col">
    <div class="colTitle">Cast citado (auto)</div>
    <div id="dayCast"></div>
  </div>

  <!-- Col 4 -->
  <div class="col">
    <div class="colTitle">Equipo t√©cnico</div>
    <div id="dayCrewPicker"></div>
  </div>
</div>
              </div>
            </div>

          </div>
        </div>
      </section>


<!-- ================= PLAN DE RODAJE (Vista diaria) ================= -->
      <section class="view hidden" id="view-dayplan">
        <div class="shootingLayout dayplanLayout" id="dayplanLayout">
          <!-- Banco -->
          <div class="col" id="dpBankCol">
            <div class="card bankCard">
              <div class="cardHeader bankHeader" id="dpSceneBankHeader">
                <h2 class="cardTitle">Banco de Escenas</h2>
                <button class="btn icon" id="dpBtnToggleBank" title="Colapsar/expandir">‚ü®</button>
              </div>

              <div class="cardContent" id="dpSceneBankBody">
                <div class="row gap">
                  <input class="input grow" id="dpBankSearch" placeholder="Buscar‚Ä¶"/>
                  <select class="input compact" id="dpBankFilter">
                    <option value="all">Todas</option>
                    <option value="unassigned">No asignadas</option>
                  </select>
                </div>
                <div class="bankList" id="dpSceneBankList"></div>
              </div>
            </div>

            <!-- Dock visible cuando est√° colapsado -->
            <div class="bankDock hidden" id="dpBankDock">
              <button class="btn icon" id="dpBtnToggleBankDock" title="Expandir">‚ü©</button>
            </div>
          </div>

          <!-- Plan -->
          <div class="col">
            <div class="card" id="dayplanCard">
          <div class="cardHeader">
            <h2 class="cardTitle">Plan de Rodaje</h2>
            <div class="row gap noPrint" style="flex-wrap:wrap">
              <select class="input compact" id="dayplanSelect"></select>
              <button class="btn" id="btnAddShootDay">+ D√≠a</button>
              <button class="btn danger" id="btnDeleteShootDay">Borrar D√≠a</button>

              <div class="row gap" style="align-items:center">
                <span class="muted">Snap</span>
                <select class="input compact" id="dayplanSnap" style="width:90px">
                  <option value="5">5m</option>
                  <option value="10">10m</option>
                  <option value="15" selected>15m</option>
                  <option value="30">30m</option>
                </select>
              </div>

              <button class="btn" id="btnDayplanAddNote">+ Nota / tarea</button>
              <button class="btn ghost" id="btnDayplanAuto" title="Acomoda el horario sin solaparse">Auto</button>
              <button class="btn" id="btnDayplanPrint">Imprimir</button>
            </div>
          </div>

          <div class="cardContent">
            <div id="dayplanHead"></div>
            <div class="spacer"></div>
            <div class="dayplanBody">

            <div class="dpScroller screenOnly" id="dpScroller">
              <div class="dpTimeCol" id="dpTimeCol"></div>
              <div class="dpLane" id="dpLane"></div>
            </div>

            
<div class="dayplanInspector noPrint" id="dayplanInspector"></div>
            </div>


            <div class="printOnly" id="dayplanPrint"></div>
</div>
        </div>
          </div>
        </div>
      </section>

      <!-- ================= CRONOGRAMA ================= -->
      <section class="view hidden" id="view-schedule">
        <div class="card" id="scheduleCard">
          <div class="cardHeader">
            <h2 class="cardTitle">Plan General</h2>
            <div class="row gap">
              <input class="input" id="schedSearch" placeholder="Buscar‚Ä¶" style="max-width:260px"/>
              <label class="row gap small muted">Zoom
                <select class="input compact" id="schedZoom">
                  <option value="60">Bajo</option>
                  <option selected="" value="90">Medio</option>
                  <option value="120">Grande</option>
                  <option value="160">Gigante</option>
                </select>
              </label>
              <label class="row gap small muted">Snap
                <select class="input compact" id="schedSnap">
                  <option value="5">5 min</option>
                  <option value="10">10 min</option>
                  <option selected="" value="15">15 min</option>
                  <option value="30">30 min</option>
                </select>
              </label>
            </div>
          </div>
          <div class="cardContent scheduleContent">
            <!-- Scroll horizontal superior (siempre accesible) -->
            <div class="schedScrollTop" id="schedScrollTop">
              <div class="schedScrollTopInner" id="schedScrollTopInner"></div>
            </div>

            <div class="schedWrap" id="schedWrap">
              <div class="schedBoard" id="schedBoard"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= SHOTLIST ================= -->
      <section class="view hidden" id="view-shotlist">
        <div class="card" id="shotlistCard">
          <div class="cardHeader">
            <h2 class="cardTitle">Shotlist</h2>
            <div class="row gap noPrint">
              <select class="input compact" id="shotDaySelect"></select>
              <button class="btn" id="btnShotPrint">Imprimir</button>
            </div>
          </div>
          <div class="cardContent">
            <div class="muted small" id="shotlistSummary">‚Äî</div>
            <div class="spacer"></div>
            <div id="shotlistWrap"></div>
          </div>
        </div>
      </section>

      <!-- ================= ELEMENTOS ================= -->
      <section class="view hidden" id="view-elements">
        <div class="grid2">
          <div class="card">
            <div class="cardHeader">
              <h2 class="cardTitle">Explorar elementos</h2>
            </div>
            <div class="cardContent">
              <div class="row gap">
                <select class="input compact" id="elxCategory"></select>
                <select class="input compact" id="elxDay"></select>
                <input class="input grow" id="elxSearch" placeholder="Buscar elemento‚Ä¶"/>
              </div>
              <div class="spacer"></div>
              <div id="elxList"></div>
            </div>
          </div>
          <div class="card">
            <div class="cardHeader">
              <h2 class="cardTitle">Detalle</h2>
            </div>
            <div class="cardContent">
              <div id="elxDetail"></div>
            </div>
        </div>
      </div></section>

      <!-- ================= CREW ================= -->
      <section class="view hidden" id="view-crew">
        <div class="card" id="crewCard">
          <div class="cardHeader">
            <h2 class="cardTitle">Equipo t√©cnico <span class="keepcase">(incluye Cast como √°rea)</span></h2>
            <div class="row gap">
              <input class="input grow" id="crewSearch" placeholder="Buscar por √°rea / rol / nombre‚Ä¶"/>
              <button class="btn" id="btnAddCrew">+ Integrante</button>
            </div>
          </div>
          <div class="cardContent">
            <div class="tableWrap">
              <table class="table" id="crewTable">
                <thead>
                  <tr>
                    <th style="width:190px;">√Årea</th>
                    <th style="width:200px;">Rol</th>
                    <th>Nombre</th>
                    <th style="width:140px;">Tel</th>
                    <th style="width:220px;">Email</th>
                    <th>Notas</th>
                    <th style="width:110px;"></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
        </div>
      </div></section>

      <!-- ================= REPORTES ================= -->
      <section class="view hidden" id="view-reports">
        <div class="card">
          <div class="cardHeader">
            <h2 class="cardTitle">Filtros</h2>
          </div>
          <div class="cardContent">
            <div class="row gap" style="margin-bottom:10px">
              <input class="input grow" id="reportsSearch" placeholder="Buscar‚Ä¶"/>
            </div>
            <div class="chips" id="reportsFilters" style="margin-bottom:10px"></div>
            <div class="reportsBoard" id="reportsBoard"></div>
          </div>
        </div>
      </section>

      <!-- ================= CALL SHEETS ================= -->
      <section class="view hidden" id="view-callsheet">
        <div class="grid2">
          <div class="card noPrint" id="callCalCard">
            <div class="cardHeader">
              <h2 class="cardTitle">Calendario</h2>
              <div class="row gap">
                <button class="btn icon" id="calPrev" title="Mes anterior">‚Äπ</button>
                <div class="muted" id="calTitle"></div>
                <button class="btn icon" id="calNext" title="Mes siguiente">‚Ä∫</button>
              </div>
            </div>
            <div class="cardContent">
              <div class="calGrid" id="calGrid"></div>
            </div>
          </div>

          <div class="card" id="callDetailCard">
            <div class="cardHeader">
              <h2 class="cardTitle">REPORTES</h2>
              <button class="btn primary" id="btnPrintCallSheet">Imprimir</button>
            </div>
            <div class="cardContent">
              <div class="reportTabs screenOnly" id="reportTabs">
                <button class="btn reportTabBtn" data-tab="dayplan">Plan de Rodaje</button>
                <button class="btn reportTabBtn active" data-tab="callsheet">Call Sheet</button>
                <button class="btn reportTabBtn" data-tab="shotlist">Shotlist</button>
                <button class="btn reportTabBtn" data-tab="elements">Elementos</button>
              </div>

              <div id="reportPane-dayplan" class="reportPane hidden">
                <div id="reportDayplanDetail"></div>
              </div>
              <div id="reportPane-callsheet" class="reportPane">
                <div id="callSheetDetail"></div>
              </div>
              <div id="reportPane-shotlist" class="reportPane hidden">
                <div id="reportShotlistDetail"></div>
              </div>
              <div id="reportPane-elements" class="reportPane hidden">
                <div id="reportElementsDetail"></div>
              </div>
            </div>
        </div>
      </div></section>

      <!-- ================= SETTINGS ================= -->
      

    </main>
  </div>
  <!-- Cache bust fuerte (mobile): cargamos assets con un v din√°mico por sesi√≥n -->
  <script>
  (function(){
    const v = Date.now().toString(36);
    // CSS: fuerza versi√≥n de sesi√≥n
    try{
      const link = document.querySelector('link[href^="css/styles.css"]') || document.querySelector('link[href*="css/styles.css"]');
      if(link) link.href = "css/styles.css?v=" + v;
    }catch(e){}

    // XLSX (intento multi-CDN para evitar bloqueos en mobile)
    const xlsxCandidates = [
      "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js",
      "https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js",
      "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"
    ];
    const appFiles = ["js/utils.js","js/storage.js","js/app.js"];

    function loadScript(src){
      return new Promise((res)=>{
        try{
          const s = document.createElement("script");
          s.src = src;
          s.async = false;
          s.onload = ()=>res(true);
          s.onerror = ()=>res(false);
          document.body.appendChild(s);
        }catch(e){ res(false); }
      });
    }

    (async function(){
      // Cargamos XLSX primero (si falla, igual seguimos: CSV sigue andando)
      if(!window.XLSX){
        for(const u of xlsxCandidates){
          const ok = await loadScript(u + "?v=" + v);
          if(ok && window.XLSX) break;
        }
      }
      // App scripts en orden
      for(const f of appFiles){
        await loadScript(f + "?v=" + v);
      }
    })();
  })();
  </script>

</body></html>